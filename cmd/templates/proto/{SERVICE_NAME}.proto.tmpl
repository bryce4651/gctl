syntax = "proto3";

package {{ .PackageName }};

option go_package = "./pkg/{{ .PackageName }}";

import "validate/validate.proto";
import "listoption/listoption.proto";
import "google/api/annotations.proto";

{{ $caseServiceName := ToCamelCase .PackageName }}
service {{ .PackageName }} {
	rpc Create{{$caseServiceName}} (Create{{$caseServiceName}}Req) returns (Create{{$caseServiceName}}Rsp){
	    option (google.api.http) = {
	        post: "/v1/{{ .PackageName }}"
	        body: "*"
	    };
	};
	rpc Update{{$caseServiceName}} (Update{{$caseServiceName}}Req) returns (Update{{$caseServiceName}}Rsp){
	    option (google.api.http) = {
            put: "/v1/{{ .PackageName }}/Update{{$caseServiceName}}"
            body: "*"
        };
	};
	rpc Delete{{$caseServiceName}} (Delete{{$caseServiceName}}Req) returns (Delete{{$caseServiceName}}Rsp){
	    option (google.api.http) = {
            delete: "/v1/{{ .PackageName }}/{id}"
        };
	};
	rpc Get{{$caseServiceName}} (Get{{$caseServiceName}}Req) returns (Get{{$caseServiceName}}Rsp){
	    option (google.api.http) = {
            get: "/v1/{{ .PackageName }}/{id}"
        };
	};
	rpc List{{$caseServiceName}} (List{{$caseServiceName}}Req) returns (List{{$caseServiceName}}Rsp){
	     option (google.api.http) = {
            get: "/v1/{{ .PackageName }}"
        };
	};
}

// range of error codes: [{{.StartErrCode}}, {{.EndErrCode}}]
enum ErrCode {
    Success = 0;
    //@status_code: 400
    ErrInvalidParam = {{.StartErrCode}}; // 非法参数
    //@status_code: 400
    ErrParamRequired = {{Add .StartErrCode 1}}; // 缺失参数
    //@status_code: 404
    ErrNotFound{{$caseServiceName}} = {{Add .StartErrCode 2}}; // 未找到相关记录
}

// GORM 索引使用示例: 
// @gorm: type:json;index:idx_ct_xx,priority:1;comment:'xxxx'
// @gorm: type:varchar(255);uniqueIndex:uidx_phone,sort:desc;comment:'phone number'


message Model{{$caseServiceName}} {
    // @gorm: primarykey
    uint64 id = 1;
    // @gorm: comment:'创建时间'
    uint32 created_at = 101;
    // @gorm: comment:'更新时间'
    uint32 updated_at = 102;
    // @gorm: comment:'删除时间'
    uint32 deleted_at = 103;
}

message Create{{$caseServiceName}}Req {
    Model{{$caseServiceName}} data = 1 [(validate.rules).message.required = true];
}
message Create{{$caseServiceName}}Rsp {
    Model{{$caseServiceName}} data = 1;
}

message Update{{$caseServiceName}}Req {
    uint64 id = 1 [(validate.rules).uint64.gt = 0];
    Model{{$caseServiceName}} data = 2 [(validate.rules).message.required = true];
}
message Update{{$caseServiceName}}Rsp {
    Model{{$caseServiceName}} data = 1;
}

message Delete{{$caseServiceName}}Req {
    uint64 id = 1 [(validate.rules).uint64.gte = 1];
    // repeated uint64 id_list = 2 [(validate.rules).repeated.min_items = 1];
}
message Delete{{$caseServiceName}}Rsp {}

message Get{{$caseServiceName}}Req {
    uint64 id = 1 [(validate.rules).uint64.gt = 0];
}
message Get{{$caseServiceName}}Rsp {
    Model{{$caseServiceName}} data = 1;
}

message List{{$caseServiceName}}Req {
    repeated uint64 id_list = 1;
    optional string name = 2;
    listoption.Paginate paginate = 3;
}
message List{{$caseServiceName}}Rsp {
    listoption.Paginate paginate = 1;
    repeated Model{{$caseServiceName}} list = 2;
}


